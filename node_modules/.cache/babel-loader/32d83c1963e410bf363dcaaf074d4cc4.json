{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\naxios.defaults.withCredentials = true;\nimport axios from 'axios';\nconst ip = \"101.42.232.181:8090\";\nimport { ColorPicker } from 'element-ui';\nexport default {\n  name: 'Exam',\n\n  data() {\n    return {\n      tableData: {\n        id: '',\n        examName: '',\n        date: '',\n        status: ''\n      },\n      ExamlogVisible: false,\n      addExam: {\n        examName: '',\n        description: '',\n        date: '',\n        status: ''\n      },\n      search: '',\n      clearData: [{\n        examName: '',\n        classId: '',\n        className: '',\n        count: '',\n        score: '',\n        total: ''\n      }],\n      addClass: {\n        classId: '',\n        classNmae: '',\n        school: ''\n      },\n      addClassVisible: false,\n      // options: [],\n      classData: [],\n      // 班级总列表\n      selectArrs: []\n    };\n  },\n\n  mounted() {\n    this.selectAll();\n    this.testlogin();\n  },\n\n  methods: {\n    sleep(n) {\n      var start = new Date().getTime();\n\n      while (true) {\n        if (new Date().getTime() - start > n) {\n          break;\n        }\n      }\n    },\n\n    testlogin() {\n      axios.get(\"http://\" + ip + \"/admin\").then(res => {\n        if (res.data.code == 20001) {} else if (res.data.code == 20000) {\n          this.$message.error(\"请先登录!!!\");\n          this.sleep(1000);\n          location.href = \"http://101.42.232.181:8089/#/login\";\n        }\n      });\n    },\n\n    // 初始化查询\n    selectAll() {\n      axios.get(\"http://\" + ip + \"/exams\").then(res => {\n        this.tableData = res.data.data;\n      });\n    },\n\n    // 添加考试\n    handleaddExam() {\n      if (this.addExam.status = true) {\n        this.addExam.status = 1;\n      } else {\n        this.addExam.status = 0;\n      }\n\n      axios.post(\"http://\" + ip + \"/exams\", this.addExam).then(res => {\n        this.ExamlogVisible = false;\n\n        if (res.data.code == 20011) {\n          this.$message.success('添加成功');\n          this.selectAll();\n        } else if (res.data.code == 20010) {\n          this.$message.error('添加失败');\n        }\n\n        this.addExam.examName = '', this.addExam.description = '', this.addExam.date = '', this.addExam.status = '';\n      });\n    },\n\n    // 查询考试的详细数据\n    selectClearData(row) {\n      axios.get(\"http://\" + ip + \"/texam/\" + row.id).then(res => {\n        this.clearData = res.data.data;\n\n        for (let index = 0; index < this.clearData.length; index++) {\n          const element = this.clearData[index];\n\n          if (element.count < element.total) {\n            element.score = '未统计完成';\n          }\n        }\n      });\n    },\n\n    //查询班级信息\n    getClassData(row) {\n      this.classData = [];\n      let cou = 0;\n      axios.get(\"http://\" + ip + \"/class\").then(res => {\n        for (let x = 0; x < res.data.data.length; x++) {\n          for (let y = 0; y < this.classData.length; y++) {\n            if (res.data.data[x].school === this.classData[y].label) {\n              this.classData[y].children.push({\n                value: res.data.data[x].classId,\n                disabled: false,\n                label: res.data.data[x].className\n              });\n              cou += 1;\n            }\n          }\n\n          if (cou == 0) {\n            this.classData.push({\n              value: x,\n              label: res.data.data[x].school,\n              children: [{\n                value: res.data.data[x].classId,\n                label: res.data.data[x].className\n              }]\n            });\n          }\n\n          cou = 0;\n        }\n      });\n      axios.get(\"http://\" + ip + \"/texam/\" + row.id).then(res => {\n        for (let index = 0; index < res.data.data.length; index++) {\n          for (let x = 0; x < this.classData.length; x++) {\n            let k = 0;\n\n            for (let y = 0; y < this.classData[x].children.length; y++) {\n              if (res.data.data[index].classId == this.classData[x].children[y].value) {\n                this.classData[x].children[y].disabled = true;\n                k += 1;\n                break;\n              }\n            }\n\n            ;\n            if (k == 1) break;\n          }\n\n          ;\n        }\n\n        ;\n      });\n      this.selectArrs = [];\n      this.selectArrs.push(row.id);\n    },\n\n    //获取选中的节点数据对象\n    changeSelectArr(val) {\n      let node_arr = this.$refs['cascader'].getCheckedNodes();\n      let select_a = [];\n      select_a.push(this.selectArrs[0]);\n\n      for (let key in node_arr) {\n        if (!node_arr[key]['data'].children) {\n          select_a.push(node_arr[key]['data'].value);\n        }\n      }\n\n      this.selectArrs = select_a;\n    },\n\n    //添加班级\n    addClassExam() {\n      axios.post(\"http://\" + ip + \"/texam/\", this.selectArrs).then(res => {\n        if (res.data.code == 20011) {\n          this.$message.success('添加成功');\n          this.selectAll();\n        } else if (res.data.code == 20010) {\n          this.$message.error('添加失败');\n        }\n      });\n      this.addClassVisible = false;\n    },\n\n    cancelClassExam() {\n      console.log(this.$refs['cascader']);\n      this.$refs['cascader'].panel.clearCheckedNodes();\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+FAA;AACA;AACA;AACA;AACA;EACAC,YADA;;EAEAC;IACA;MACAC;QACAC,MADA;QAEAC,YAFA;QAGAC,QAHA;QAIAC;MAJA,CADA;MAOAC,qBAPA;MAQAC;QACAJ,YADA;QAEAK,eAFA;QAGAJ,QAHA;QAIAC;MAJA,CARA;MAcAI,UAdA;MAeAC;QACAP,YADA;QAEAQ,WAFA;QAGAC,aAHA;QAIAC,SAJA;QAKAC,SALA;QAMAC;MANA,EAfA;MAuBAC;QACAL,WADA;QAEAM,aAFA;QAGAC;MAHA,CAvBA;MA4BAC,sBA5BA;MA6BA;MACAC,aA9BA;MA8BA;MACAC;IA/BA;EAiCA,CApCA;;EAuCAC;IACA;IACA;EACA,CA1CA;;EA2CAC;IACAC;MACA;;MACA;QACA;UACA;QACA;MACA;IAEA,CATA;;IAWAC;MAEA3B;QAEA,6BAIA,CAJA,MAIA;UAEA;UAEA;UAIA4B;QACA;MAEA,CAjBA;IAkBA,CA/BA;;IAmCA;IACAC;MACA7B;QACA;MACA,CAFA;IAGA,CAxCA;;IAyCA;IACA8B;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;;MAEA9B;QACA;;QACA;UACA;UACA;QACA,CAHA,MAGA;UACA;QACA;;QACA,4BACA,6BADA,EAEA,sBAFA,EAGA,wBAHA;MAIA,CAZA;IAaA,CA9DA;;IA+DA;IACA+B;MAEA/B;QACA;;QACA;UACA;;UACA;YACAgC;UACA;QAEA;MACA,CATA;IAUA,CA5EA;;IA6EA;IACAC;MACA;MACA;MACAjC;QACA;UACA;YACA;cACA;gBACAkC,+BADA;gBAEAC,eAFA;gBAGAC;cAHA;cAKAC;YACA;UACA;;UACA;YACA;cACAH,QADA;cAEAE,8BAFA;cAGAE;gBACAJ,+BADA;gBAEAE;cAFA;YAHA;UAQA;;UACAC;QACA;MACA,CAxBA;MAyBArC;QACA;UACA;YACA;;YACA;cACA;gBACA;gBACAuC;gBACA;cACA;YACA;;YAAA;YACA,YACA;UACA;;UAAA;QACA;;QAAA;MACA,CAfA;MAgBA;MACA;IAEA,CA7HA;;IA8HA;IACAC;MACA;MACA;MACAC;;MACA;QACA;UACAA;QACA;MACA;;MACA;IACA,CAzIA;;IA0IA;IACAC;MACA1C;QACA;UACA;UACA;QACA,CAHA,MAGA;UACA;QACA;MAEA,CARA;MASA;IACA,CAtJA;;IAuJA2C;MACAC;MACA;IACA;;EA1JA;AA3CA","names":["axios","name","data","tableData","id","examName","date","status","ExamlogVisible","addExam","description","search","clearData","classId","className","count","score","total","addClass","classNmae","school","addClassVisible","classData","selectArrs","mounted","methods","sleep","testlogin","location","selectAll","handleaddExam","selectClearData","element","getClassData","value","disabled","label","cou","children","k","changeSelectArr","select_a","addClassExam","cancelClassExam","console"],"sourceRoot":"views/exam","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <br>\r\n    <el-row>\r\n\r\n      <el-button type=\"primary\" @click=\"ExamlogVisible = true\" round>新增考试</el-button>\r\n      <!-- <el-button type=\"danger\" @click=\"deleteByIds\" round>批量删除</el-button> -->\r\n    </el-row>\r\n    <br>\r\n    <el-divider></el-divider>\r\n    <el-table :data=\"tableData.filter(data => !search || data.name.toLowerCase().includes(search.toLowerCase()))\"\r\n      style=\"width: 100%\" max-height=\"400\">\r\n\r\n      <el-table-column label=\"序号\" type=\"index\">\r\n      </el-table-column>\r\n\r\n      <el-table-column label=\"名称\" prop=\"examName\" header-align=\"center\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column label=\"日期\" prop=\"date\" header-align=\"center\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column label=\"状态\" prop=\"status\" header-align=\"center\" align=\"center\">\r\n\r\n      </el-table-column>\r\n      <el-table-column align=\"right\">\r\n        <template slot=\"header\">\r\n          <el-input v-model=\"search\" size=\"mini\" placeholder=\"输入关键字搜索\" />\r\n        </template>\r\n\r\n        <template slot-scope=\"scope\">\r\n          <el-button type=\"primary\" size=\"mini\" @click=\"selectClearData(scope.row)\">考试详情</el-button>\r\n          <el-button size=\"mini\" @click=\"addClassVisible = true; getClassData(scope.row)\">添加班级</el-button>\r\n          <!-- <el-button size=\"mini\" type=\"danger\" @click=\"handleDelete(scope.$index, scope.row)\">Delete</el-button> -->\r\n        </template>\r\n      </el-table-column>\r\n\r\n    </el-table>\r\n    <!--    新增窗口-->\r\n    <el-dialog title=\"新增考试\" :visible.sync=\"ExamlogVisible\" width=\"18%\">\r\n\r\n      <el-form ref=\"form\" :model=\"addExam\" label-width=\"40px\" style=\"text-align: center\">\r\n        <el-form-item label=\"名称\">\r\n          <el-input v-model=\"addExam.examName\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"描述\">\r\n          <el-input v-model=\"addExam.description\" placeholder=\"请输入内容\"></el-input>\r\n        </el-form-item>\r\n        <el-form>\r\n          <div class=\"block\">\r\n            <span class=\"demonstration\">日期</span>\r\n            <el-date-picker v-model=\"addExam.date\" type=\"date\" placeholder=\"选择日期\">\r\n            </el-date-picker>\r\n          </div>\r\n        </el-form>\r\n        <el-form-item label=\"\">\r\n          <el-switch v-model=\"addExam.status\" active-text=\"立即开启\" inactive-text=\"稍后开启\">\r\n          </el-switch>\r\n        </el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleaddExam\">提交</el-button>\r\n        <el-button @click=\"ExamlogVisible = false\">取消</el-button>\r\n      </el-form>\r\n\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n\r\n      </span>\r\n    </el-dialog>\r\n    <!-- 考试详情 -->\r\n    <template>\r\n      <el-divider></el-divider>\r\n      <el-table :data=\"clearData\" style=\"width: 100%\" max-height=\"300\">\r\n        <el-table-column label=\"序号\" type=\"index\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"className\" label=\"班级名称\" width=\"180\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"count\" label=\"已填写人数\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"score\" label=\"分数\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"total\" label=\"总人数\">\r\n        </el-table-column>\r\n      </el-table>\r\n    </template>\r\n    <!-- 新增班级 -->\r\n    <el-dialog title=\"新增班级\" :visible.sync=\"addClassVisible\" width=\"18%\">\r\n      <el-cascader placeholder=\"试试搜索：班级\" ref=\"cascader\" @change=\"changeSelectArr\" :options=\"classData\"\r\n        :props=\"{ multiple: true }\" filterable></el-cascader>\r\n      <el-button type=\"primary\" @click=\"addClassExam()\">提交</el-button>\r\n      <el-button @click=\"addClassVisible = false; cancelClassExam(val)\">取消</el-button>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\naxios.defaults.withCredentials = true;\r\nimport axios from 'axios';\r\nconst ip = \"101.42.232.181:8090\";\r\nimport { ColorPicker } from 'element-ui';\r\nexport default {\r\n  name: 'Exam',\r\n  data() {\r\n    return {\r\n      tableData: {\r\n        id: '',\r\n        examName: '',\r\n        date: '',\r\n        status: ''\r\n      },\r\n      ExamlogVisible: false,\r\n      addExam: {\r\n        examName: '',\r\n        description: '',\r\n        date: '',\r\n        status: '',\r\n      },\r\n      search: '',\r\n      clearData: [{\r\n        examName: '',\r\n        classId: '',\r\n        className: '',\r\n        count: '',\r\n        score: '',\r\n        total: ''\r\n      }],\r\n      addClass: {\r\n        classId: '',\r\n        classNmae: '',\r\n        school: '',\r\n      },\r\n      addClassVisible: false,\r\n      // options: [],\r\n      classData: [], // 班级总列表\r\n      selectArrs: [],\r\n    }\r\n  },\r\n\r\n\r\n  mounted() {\r\n    this.selectAll();\r\n    this.testlogin();\r\n  },\r\n  methods: {\r\n    sleep(n) {\r\n      var start = new Date().getTime();\r\n      while (true) {\r\n        if (new Date().getTime() - start > n) {\r\n          break;\r\n        }\r\n      }\r\n\r\n    },\r\n\r\n    testlogin() {\r\n\r\n      axios.get(\"http://\" + ip + \"/admin\").then(res => {\r\n\r\n        if (res.data.code == 20001) {\r\n\r\n\r\n\r\n        } else if (res.data.code == 20000) {\r\n\r\n          this.$message.error(\"请先登录!!!\");\r\n\r\n          this.sleep(1000);\r\n\r\n\r\n\r\n          location.href = \"http://101.42.232.181:8089/#/login\"\r\n        }\r\n\r\n      })\r\n    },\r\n\r\n\r\n\r\n    // 初始化查询\r\n    selectAll() {\r\n      axios.get(\"http://\" + ip + \"/exams\").then(res => {\r\n        this.tableData = res.data.data;\r\n      })\r\n    },\r\n    // 添加考试\r\n    handleaddExam() {\r\n      if(this.addExam.status=true){\r\n        this.addExam.status=1;\r\n      }else{\r\n        this.addExam.status=0;\r\n      }\r\n\r\n      axios.post(\"http://\" + ip + \"/exams\", this.addExam).then(res => {\r\n        this.ExamlogVisible = false;\r\n        if (res.data.code == 20011) {\r\n          this.$message.success('添加成功');\r\n          this.selectAll();\r\n        } else if (res.data.code == 20010) {\r\n          this.$message.error('添加失败');\r\n        }\r\n        this.addExam.examName = '',\r\n          this.addExam.description = '',\r\n          this.addExam.date = '',\r\n          this.addExam.status = ''\r\n      })\r\n    },\r\n    // 查询考试的详细数据\r\n    selectClearData(row) {\r\n\r\n      axios.get(\"http://\" + ip + \"/texam/\" + row.id).then(res => {\r\n        this.clearData = res.data.data;\r\n        for (let index = 0; index < this.clearData.length; index++) {\r\n                            const element = this.clearData[index];\r\n                            if(element.count<element.total){\r\n                                element.score = '未统计完成'\r\n                            }\r\n                            \r\n                        }\r\n      })\r\n    },\r\n    //查询班级信息\r\n    getClassData(row) {\r\n      this.classData = []\r\n      let cou = 0\r\n      axios.get(\"http://\" + ip + \"/class\").then(res => {\r\n        for (let x = 0; x < res.data.data.length; x++) {\r\n          for (let y = 0; y < this.classData.length; y++) {\r\n            if (res.data.data[x].school === this.classData[y].label) {\r\n              this.classData[y].children.push({\r\n                value: res.data.data[x].classId,\r\n                disabled: false,\r\n                label: res.data.data[x].className\r\n              });\r\n              cou += 1\r\n            }\r\n          }\r\n          if (cou == 0) {\r\n            this.classData.push({\r\n              value: x,\r\n              label: res.data.data[x].school,\r\n              children: [{\r\n                value: res.data.data[x].classId,\r\n                label: res.data.data[x].className\r\n              }]\r\n            })\r\n          }\r\n          cou = 0\r\n        }\r\n      })\r\n      axios.get(\"http://\" + ip + \"/texam/\" + row.id).then(res => {\r\n        for (let index = 0; index < res.data.data.length; index++) {\r\n          for (let x = 0; x < this.classData.length; x++) {\r\n            let k = 0;\r\n            for (let y = 0; y < this.classData[x].children.length; y++) {\r\n              if (res.data.data[index].classId == this.classData[x].children[y].value) {\r\n                this.classData[x].children[y].disabled = true\r\n                k += 1\r\n                break\r\n              }\r\n            };\r\n            if (k == 1)\r\n              break\r\n          };\r\n        };\r\n      })\r\n      this.selectArrs = []\r\n      this.selectArrs.push(row.id)\r\n\r\n    },\r\n    //获取选中的节点数据对象\r\n    changeSelectArr(val) {\r\n      let node_arr = this.$refs['cascader'].getCheckedNodes();\r\n      let select_a = [];\r\n      select_a.push(this.selectArrs[0])\r\n      for (let key in node_arr) {\r\n        if (!node_arr[key]['data'].children) {\r\n          select_a.push(node_arr[key]['data'].value)\r\n        }\r\n      }\r\n      this.selectArrs = select_a\r\n    },\r\n    //添加班级\r\n    addClassExam() {\r\n      axios.post(\"http://\" + ip + \"/texam/\", this.selectArrs).then(res => {\r\n        if (res.data.code == 20011) {\r\n          this.$message.success('添加成功');\r\n          this.selectAll();\r\n        } else if (res.data.code == 20010) {\r\n          this.$message.error('添加失败');\r\n        }\r\n\r\n      })\r\n      this.addClassVisible = false;\r\n    },\r\n    cancelClassExam() {\r\n      console.log(this.$refs['cascader'])\r\n      this.$refs['cascader'].panel.clearCheckedNodes();\r\n    },\r\n\r\n  }\r\n}\r\n\r\n\r\n\r\n</script>\r\n\r\n<style>\r\n.el-table .warning-row {\r\n  background: oldlace;\r\n}\r\n\r\n.el-table .success-row {\r\n  background: #f0f9eb;\r\n}\r\n</style>\r\n\r\n"]},"metadata":{},"sourceType":"module"}